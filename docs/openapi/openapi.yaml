openapi: 3.0.0
paths:
  /health:
    get:
      description: Indicates whether the process is alive.
      operationId: health.get
      parameters: []
      responses:
        "200":
          description: Liveness check.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                required:
                  - status
      summary: Liveness check
      tags:
        - Health
      x-error-codes:
        - INTERNAL
  /ready:
    get:
      description: Indicates whether the service is ready to receive traffic.
      operationId: ready.get
      parameters: []
      responses:
        "200":
          description: Readiness check.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                required:
                  - status
      summary: Readiness check
      tags:
        - Health
      x-error-codes:
        - INTERNAL
  /v1/auth/password/register:
    post:
      description: Creates a user and immediately issues first-party access + refresh
        tokens.
      operationId: auth.password.register
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PasswordRegisterRequestDto"
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResultEnvelopeDto"
      summary: Register (password)
      tags: &a1
        - Auth
      x-error-codes:
        - VALIDATION_FAILED
        - AUTH_EMAIL_ALREADY_EXISTS
        - INTERNAL
  /v1/auth/password/login:
    post:
      description: Authenticates a user and issues first-party access + refresh tokens.
      operationId: auth.password.login
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PasswordLoginRequestDto"
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResultEnvelopeDto"
      summary: Login (password)
      tags: *a1
      x-error-codes:
        - VALIDATION_FAILED
        - AUTH_INVALID_CREDENTIALS
        - RATE_LIMITED
        - INTERNAL
  /v1/auth/refresh:
    post:
      description: Rotates the refresh token and returns a new access + refresh token.
      operationId: auth.refresh
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshRequestDto"
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResultEnvelopeDto"
      summary: Refresh tokens
      tags: *a1
      x-error-codes:
        - VALIDATION_FAILED
        - AUTH_REFRESH_TOKEN_INVALID
        - AUTH_REFRESH_TOKEN_EXPIRED
        - AUTH_REFRESH_TOKEN_REUSED
        - AUTH_SESSION_REVOKED
        - INTERNAL
  /v1/auth/logout:
    post:
      description: Revokes the session associated with the provided refresh token.
      operationId: auth.logout
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LogoutRequestDto"
      responses:
        "204":
          description: ""
      summary: Logout
      tags: *a1
      x-error-codes:
        - VALIDATION_FAILED
        - AUTH_REFRESH_TOKEN_INVALID
        - INTERNAL
  /.well-known/jwks.json:
    get:
      description: Publishes public keys used to verify access tokens.
      operationId: auth.jwks.get
      parameters: []
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: object
                properties:
                  keys:
                    type: array
                    items:
                      type: object
                required:
                  - keys
      summary: JWKS
      tags:
        - Auth
      x-error-codes:
        - INTERNAL
  /v1/me:
    get:
      description: Returns the authenticated user profile.
      operationId: users.me.get
      parameters: []
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MeEnvelopeDto"
      security:
        - access-token: []
      summary: Get current user
      tags: &a2
        - Users
      x-error-codes:
        - UNAUTHORIZED
        - INTERNAL
    patch:
      description: Partially updates the authenticated user profile. Omitted fields
        are unchanged; null clears a field.
      operationId: users.me.patch
      parameters:
        - name: Idempotency-Key
          in: header
          description: "Idempotency key for safe retries of write requests. Replays return
            `Idempotency-Replayed: true`."
          required: false
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchMeRequestDto"
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MeEnvelopeDto"
      security:
        - access-token: []
      summary: Update current user profile
      tags: *a2
      x-error-codes:
        - VALIDATION_FAILED
        - UNAUTHORIZED
        - IDEMPOTENCY_IN_PROGRESS
        - CONFLICT
        - INTERNAL
  /v1/admin/whoami:
    get:
      description: Returns the authenticated principal as derived from the access token.
      operationId: admin.whoami.get
      parameters: []
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminWhoamiEnvelopeDto"
      security:
        - access-token: []
      summary: Get current principal (admin)
      tags:
        - Admin
      x-error-codes:
        - UNAUTHORIZED
        - FORBIDDEN
        - INTERNAL
  /v1/admin/users:
    get:
      description: Admin-only user listing with cursor pagination, sorting, filtering,
        and search.
      operationId: admin.users.list
      parameters:
        - name: limit
          required: false
          in: query
          description: Max results to return (default 25, max 250).
          schema:
            type: integer
            minimum: 1
            maximum: 250
            default: 25
        - name: cursor
          required: false
          in: query
          description: Opaque cursor from the previous response meta.nextCursor.
          schema:
            type: string
        - name: sort
          required: false
          in: query
          description: 'Comma-separated fields; prefix "-" for descending. Max 3 fields.
            Default: "-createdAt". Allowed: createdAt, email, id'
          schema:
            type: string
            example: -createdAt
        - name: q
          required: false
          in: query
          description: Free-text search query (endpoint-specific semantics).
          schema:
            type: string
        - name: filter[createdAt][gte]
          required: false
          in: query
          schema:
            type: string
            format: date-time
        - name: filter[createdAt][lte]
          required: false
          in: query
          schema:
            type: string
            format: date-time
        - name: filter[email]
          required: false
          in: query
          schema:
            type: string
        - name: filter[emailVerified]
          required: false
          in: query
          schema:
            type: boolean
        - name: filter[role]
          required: false
          in: query
          schema:
            type: string
            enum:
              - USER
              - ADMIN
        - name: filter[role][in]
          required: false
          in: query
          description: Comma-separated list (no repeated params).
          schema:
            type: string
            example: A,B,C
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminUsersListEnvelopeDto"
      security:
        - access-token: []
      summary: List users
      tags:
        - Admin
      x-error-codes:
        - VALIDATION_FAILED
        - UNAUTHORIZED
        - FORBIDDEN
        - INTERNAL
info:
  title: Backend Core Kit API
  description: Generated API contract (code-first).
  version: 0.1.0
  contact: {}
tags:
  - name: Health
    description: Service health and readiness endpoints.
  - name: Auth
    description: Authentication and session endpoints.
  - name: Users
    description: User profile endpoints.
  - name: Admin
    description: Administrative endpoints (RBAC-protected).
servers:
  - url: /
components:
  securitySchemes:
    access-token:
      scheme: bearer
      bearerFormat: JWT
      type: http
      description: "First-party access token (Authorization: Bearer <token>)"
  schemas:
    PasswordRegisterRequestDto:
      type: object
      properties:
        email:
          type: string
          example: user@example.com
        password:
          type: string
          minLength: 10
        deviceId:
          type: string
          description: Stable per-device identifier (recommended).
        deviceName:
          type: string
          description: Human-friendly device name (optional).
      required:
        - email
        - password
    AuthUserDto:
      type: object
      properties:
        id:
          type: string
          example: 3d2c7b2a-2dd6-46a5-8f8e-3b5de8a5b0f0
        email:
          type: string
          example: user@example.com
        emailVerified:
          type: boolean
          example: false
      required:
        - id
        - email
        - emailVerified
    AuthResultDto:
      type: object
      properties:
        user:
          $ref: "#/components/schemas/AuthUserDto"
        accessToken:
          type: string
          example: <access-token>
        refreshToken:
          type: string
          example: <refresh-token>
      required:
        - user
        - accessToken
        - refreshToken
    AuthResultEnvelopeDto:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/AuthResultDto"
      required:
        - data
    PasswordLoginRequestDto:
      type: object
      properties:
        email:
          type: string
          example: user@example.com
        password:
          type: string
          minLength: 1
        deviceId:
          type: string
          description: Stable per-device identifier (recommended).
        deviceName:
          type: string
          description: Human-friendly device name (optional).
      required:
        - email
        - password
    RefreshRequestDto:
      type: object
      properties:
        refreshToken:
          type: string
          example: <refresh-token>
      required:
        - refreshToken
    LogoutRequestDto:
      type: object
      properties:
        refreshToken:
          type: string
          example: <refresh-token>
      required:
        - refreshToken
    MeProfileDto:
      type: object
      properties:
        displayName:
          type: string
          example: Dante
          nullable: true
        givenName:
          type: string
          example: Dante
          nullable: true
        familyName:
          type: string
          example: Alighieri
          nullable: true
    MeDto:
      type: object
      properties:
        id:
          type: string
          example: 3d2c7b2a-2dd6-46a5-8f8e-3b5de8a5b0f0
        email:
          type: string
          example: user@example.com
        emailVerified:
          type: boolean
          example: false
        roles:
          example:
            - USER
          type: array
          items:
            type: string
        profile:
          $ref: "#/components/schemas/MeProfileDto"
      required:
        - id
        - email
        - emailVerified
        - roles
        - profile
    MeEnvelopeDto:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/MeDto"
      required:
        - data
    PatchMeProfileDto:
      type: object
      properties:
        displayName:
          type: string
          example: Dante
          nullable: true
          minLength: 1
          maxLength: 100
        givenName:
          type: string
          example: Dante
          nullable: true
          minLength: 1
          maxLength: 100
        familyName:
          type: string
          example: Alighieri
          nullable: true
          minLength: 1
          maxLength: 100
    PatchMeRequestDto:
      type: object
      properties:
        profile:
          $ref: "#/components/schemas/PatchMeProfileDto"
      required:
        - profile
    AdminWhoamiDto:
      type: object
      properties:
        userId:
          type: string
          example: 3d2c7b2a-2dd6-46a5-8f8e-3b5de8a5b0f0
        sessionId:
          type: string
          example: c1b6c1f7-5b2f-4e53-b33b-5af7f63a8c40
        emailVerified:
          type: boolean
          example: false
        roles:
          example:
            - ADMIN
          type: array
          items:
            type: string
      required:
        - userId
        - sessionId
        - emailVerified
        - roles
    AdminWhoamiEnvelopeDto:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/AdminWhoamiDto"
      required:
        - data
    AdminUserDto:
      type: object
      properties:
        id:
          type: string
          example: 3d2c7b2a-2dd6-46a5-8f8e-3b5de8a5b0f0
        email:
          type: string
          example: user@example.com
        emailVerified:
          type: boolean
          example: false
        roles:
          example:
            - USER
          type: array
          items:
            type: string
        createdAt:
          type: string
          example: 2026-01-10T12:34:56.789Z
          format: date-time
      required:
        - id
        - email
        - emailVerified
        - roles
        - createdAt
    CursorPaginationMetaDto:
      type: object
      properties:
        limit:
          type: number
          example: 25
        hasMore:
          type: boolean
          example: true
        nextCursor:
          type: string
          example: eyJ2IjoxLCJzb3J0IjoiLWNyZWF0ZWRBdCIsImFmdGVyIjp7fX0
      required:
        - limit
        - hasMore
    AdminUsersListEnvelopeDto:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/AdminUserDto"
        meta:
          $ref: "#/components/schemas/CursorPaginationMetaDto"
      required:
        - data
        - meta
